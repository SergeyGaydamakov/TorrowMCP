# Torrow MCP Service

MCP сервер для сервиса Torrow, который позволяет управлять заметками и каталогами через Model Context Protocol.

## Возможности

### Управление Заметками (Notes)
- ✅ **Создание заметки** - создает новую заметку в текущем каталоге
- ✅ **Изменение заметки** - изменяет текущую заметку  
- ✅ **Удаление заметки** - удаляет текущую заметку
- ✅ **Получение информации о заметке** - выводит данные заметки
- ✅ **Поиск заметок** - ищет заметки по фразе и тегам

### Управление Каталогами (Archives)
- ✅ **Создание каталога** - создает новый каталог (максимум 10)
- ✅ **Изменение каталога** - изменяет текущий каталог
- ✅ **Удаление каталога** - удаляет текущий каталог с опциональным удалением всех заметок
- ✅ **Получение информации о каталоге** - выводит данные каталога
- ✅ **Список каталогов** - выводит все доступные каталоги

### Контекст общения
- ✅ **Выбор каталога** - устанавливает текущий каталог
- ✅ **Выбор заметки** - устанавливает текущую заметку
- ✅ **Статус контекста** - показывает текущий каталог и заметку

## Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd torrow-mcp-service
```

2. Установите зависимости:
```bash
npm install
```

3. Скопируйте файл конфигурации:
```bash
cp env.example .env
```

4. Укажите ваш токен Torrow в файле `.env`:
```env
TORROW_TOKEN=your_torrow_token_here
```

5. Соберите проект:
```bash
npm run build
```

## Использование

### Запуск в режиме разработки
```bash
npm run dev
```

### Запуск собранной версии
```bash
npm start
```

### Запуск тестов
```bash
npm test
```

### Запуск тестов в режиме наблюдения
```bash
npm run test:watch
```

## Конфигурация

Токен Torrow можно передать двумя способами:

1. **Переменная окружения** (рекомендуется):
```bash
export TORROW_TOKEN="your_token"
```

2. **Файл .env**:
```env
TORROW_TOKEN=your_token
```

Токен может быть с префиксом "Bearer " или без него - сервер автоматически добавит префикс если его нет.

## Формат фраз

Заметки и каталоги создаются из фраз в специальном формате:

```
<название>.<текст>#тег1#тег2#тег3
```

### Примеры:

- `Рецепты. Описание приготовления блюд. #Еда` 
  - Название: "Рецепты"
  - Текст: "Описание приготовления блюд."
  - Теги: ["Еда"]

- `Рецепт макарон. Сварить макароны 15 минут. #Рецепты#Еда#Макароны`
  - Название: "Рецепт макарон"  
  - Текст: "Сварить макароны 15 минут."
  - Теги: ["Рецепты", "Еда", "Макароны"]

- `Простая заметка` 
  - Название: "Простая заметка"
  - Текст: отсутствует
  - Теги: отсутствуют

## MCP Resources

### `torrow://note/{torrowId}`
Получает информацию о заметке по ID.

### `torrow://archive/{torrowId}`  
Получает информацию о каталоге по ID.

### `torrow://archives`
Получает список всех каталогов.

## MCP Tools

### `create_note`
Создает новую заметку в текущем каталоге.

**Параметры:**
- `phrase` - фраза в формате `<название>.<текст>#тег1#тег2`

### `update_note`
Изменяет текущую заметку.

**Параметры:**
- `phrase` - новая фраза в формате `<название>.<текст>#тег1#тег2`

### `delete_note`
Удаляет текущую заметку.

### `search_notes`
Ищет заметки в текущем каталоге.

**Параметры:**
- `phrase` (опционально) - поисковая фраза
- `tags` (опционально) - массив тегов для фильтрации
- `limit` (опционально) - максимальное количество результатов (по умолчанию: 10)

### `create_archive`
Создает новый каталог.

**Параметры:**
- `phrase` - фраза в формате `<название>.<текст>#тег1#тег2`

### `update_archive`
Изменяет текущий каталог.

**Параметры:**
- `phrase` - новая фраза в формате `<название>.<текст>#тег1#тег2`

### `delete_archive`
Удаляет текущий каталог.

**Параметры:**
- `cascade` (опционально) - удалить все заметки в каталоге (по умолчанию: false)

## MCP Prompts

### `select_archive`
Выбирает каталог по названию и делает его текущим.

**Параметры:**
- `archiveName` - название каталога

### `select_note`
Выбирает заметку по названию или индексу и делает её текущей.

**Параметры:**
- `noteName` (опционально) - название заметки
- `noteIndex` (опционально) - индекс заметки из результатов поиска (начиная с 1)

### `context_status`
Показывает текущий статус контекста (текущий каталог и заметка).

## Ограничения

- Максимальное количество каталогов: 10
- Максимальная длина названия: 100 символов
- При создании каталога/заметки проверяется уникальность названия
- Операции изменения/удаления работают только с текущими объектами

## Архитектура

```
src/
├── common/          # Общие типы и ошибки
├── context/         # Управление контекстом общения
├── prompts/         # MCP prompts
├── resources/       # MCP resources  
├── tools/           # MCP tools
├── torrow/          # Клиент Torrow API
├── util/            # Утилиты
├── tests/           # Тесты
└── index.ts         # Главный файл сервера
```

## Разработка

### Требования
- Node.js 18+
- TypeScript 5+

### Установка зависимостей разработки
```bash
npm install
```

### Линтинг и форматирование
Проект использует ESLint и Prettier (настройки в package.json).

### Тестирование  
Используется Jest с поддержкой TypeScript и ESM модулей.

## Лицензия

MIT
